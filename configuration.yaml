homeassistant:
  auth_providers:
    - type: homeassistant
    - type: trusted_networks
      trusted_networks:
        - 10.20.0.0/24
  customize:
    sensor.humidity:
      icon: mdi:water-percent
  name: Home
  latitude: !secret latitude
  longitude: !secret longitude
  elevation: 45
  unit_system: metric
  time_zone: Europe/London
  currency: GBP

lovelace:
  mode: storage
  dashboards:
    lovelace-minimalist:
      mode: yaml
      title: Minimalist
      icon: mdi:script
      show_in_sidebar: true
      filename: lovelace-minimalist.yaml

default_config:

http:
  cors_allowed_origins:
    - https://hass.microserver.space
  server_host: 0.0.0.0
  ip_ban_enabled: true
  login_attempts_threshold: 5
  use_x_forwarded_for: true
  trusted_proxies:
    - 10.244.0.0/16
    - 127.0.0.1
    - ::1

auth_header:
  username_header: X-authentik-username
  debug: false

recorder:
  auto_purge: true
  auto_repack: true
  purge_keep_days: 7
  db_url: !secret db_url
  exclude:
    domains:
      - device_tracker
      - weather
    entities:
      - sensor.date
      - sensor.time
      - switch.friedland_57399aa6_1
    entity_globs:
      - switch.remote_button_*

logbook:

influxdb:
  host: influxdb.home.svc.cluster.local
  port: 8086
  database: home_assistant
  username: admin
  password: !secret influxdb_password

system_health:

logger:
  default: error
  logs:
    custom_components.auth_header: warning
    homeassistant.components.androidtv.media_player: info
    # homeassistant.components.rflink: debug

frontend:
  themes: !include_dir_merge_named themes

config:

history:

sun:

weather:
  - platform: darksky
    api_key: !secret darksky_apikey
    mode: daily

group: !include groups.yaml
automation: !include automations.yaml
sensor: !include sensors.yaml
scene: !include scenes.yaml

mqtt:
  broker: emqx-headless.home.svc
  port: 1883
  client_id: home-assistant
  username: mqtt
  password: !secret mqtt_password
  discovery: true
  discovery_prefix: homeassistant
  birth_message:
    topic: 'homeassistant/status'
    payload: 'online'
  will_message:
    topic: 'homeassistant/status'
    payload: 'offline'
  light:
    - name: Hallway
      schema: json
      state_topic: 'AiLight-188593'
      command_topic: 'AiLight-188593/set'
      color_temp: true
      brightness: true
      rgb: true
      white_value: true
      effect: false
      optimistic: false

light:
  - platform: rflink
    automatic_add: false

alexa:
  smart_home:
    locale: en-GB
    endpoint: https://api.eu.amazonalexa.com/v3/events
    client_id: !secret alexa_client_id
    client_secret: !secret alexa_client_secret
    filter:
      include_domains:
        - light
        - climate
        - scene
      include_entities:
        - group.office_group
        - sensor.landing_temperature
        - sensor.upstairs_temperature
        - sensor.temperature_humidity_sensor_temperature
        - sensor.bme680_temperature
        - switch.sonoff_s26_1_relay
        - switch.sonoff_s26_2_relay
        - switch.office_light_switch
    entity_config:
      group.office_lights:
        display_categories: LIGHT

energy:

utility_meter:
  daily_energy:
    source: sensor.ovo_last_electricity_reading
    name: Daily Energy
    cycle: daily
    tariffs:
      - peak
      - offpeak
  monthly_energy:
    source: sensor.ovo_last_electricity_reading
    name: Monthly Energy
    cycle: monthly
    tariffs:
      - peak
      - offpeak

prometheus:
  namespace: hass

# media_player:
#   - platform: androidtv
#     name: Living Room - Nvidia Shield
#     host: 10.20.0.83
#     apps:
#         com.android.tv.settings: "Settings"
#         com.plexapp.android: "Plex"
#         com.amazon.avod: "Amazon Prime"
#     state_detection_rules:
#         'com.android.tv.settings':
#           - 'idle'
#         'com.android.vending':
#           - 'idle'
#         'com.plexapp.android':
#           - 'paused':
#               'media_session_state': 3  # this indentation is important!
#               'wake_lock_size': 1       # this indentation is important!
#           - 'playing':
#               'media_session_state': 3  # this indentation is important!
#           - 'standby'
#         'com.amazon.avod':
#           - 'playing':
#               'wake_lock_size': 4  # this indentation is important!
#           - 'playing':
#               'wake_lock_size': 3  # this indentation is important!
#           - 'paused':
#               'wake_lock_size': 2  # this indentation is important!
#           - 'paused':
#               'wake_lock_size': 1  # this indentation is important!
#           - 'idle'

alarm_control_panel:
  - platform: manual
    name: Alarm Panel
    code: !secret alarm_code
    arming_time: 20
    delay_time: 60
    trigger_time: 4
    disarmed:
      trigger_time: 0
    armed_home:
      arming_time: 0
      delay_time: 0

input_boolean:
  # auto-run stuff
  auto_arm_disarm_alarm_night:
    name: Arm alarm at midnight and disarm at 5am
  auto_arm_alarm_when_gone:
    name: Automatically arm alarm when no one is home
    initial: on
  auto_disarm_alarm_when_home:
    name: Automatically disarm alarm when someone comes home
    initial: on
  minimalist_ui:
    name: Minimalist UI
  
  # notifications
  notify_alarm_armed:
    name: Notification when alarm is armed
    initial: on
  notify_alarm_disarmed:
    name: Notification when alarm is disarmed
    initial: on
  notify_alarm_triggered:
    name: Notification when alarm is triggered
    initial: on
  
  # Heating
  enable_heating_schedules:
    name: Enable heating schedules
    initial: on

  # Cameras
  camera_driveway_notify:
    name: Notify driveway camera
    initial: on
  camera_lounge_notify:
    name: Notify lounge camera
    initial: on
  camera_office_notify:
    name: Notify office camera
    initial: on

  # Aircon
  auto_enable_aircon_swing_mode:
    name: Enable swing mode when unit is on
  auto_set_aircon_temperature:
    name: Set temperature when presence detected

waste_collection_schedule:
  sources:
    - name: wiltshire_gov_uk
      args:
        uprn: !secret uprn
        postcode: !secret postcode

rflink:
  host: 10.20.0.86
  port: 23
  tcp_keepalive_idle_timer: 600
  # port: /dev/serial/by-id/usb-1a86_USB_Serial-if00-port0
  # wait_for_ack: false

switch:
  platform: rflink
  devices:
    ev1527_00bae8_08:
      name: remote_button_b
      fire_event: true
    eurodomest_0f4517_07:
      name: remote_button_c
      fire_event: true
    eurodomest_0f4517_06:
      name: remote_button_a
      fire_event: true
    eurodomest_0f4517_05:
      name: remote_button_d
      fire_event: true
    friedland_57399aa6_1:
      fire_event: true

climate:
  - platform: midea_ac
    host: 192.168.1.20
    id: 42880953513406
    token: !secret midea_token
    k1:  !secret midea_key

input_select:
  minimalist_ui_switch:
    name: Select popup/view
    options:
      - light 1
      - light 2
      - light 3
      - light 4
      - light 5
      - light 6
      - mediaplayer 1
      - mediaplayer 2
      - climate 1
      - climate 2
      - power 1
      - power 2
      - livingroom