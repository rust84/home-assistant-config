homeassistant:
  auth_providers:
    - type: homeassistant
    - type: trusted_networks
      trusted_networks:
        - 10.43.0.0/16
        - 10.20.0.52/32
    # - type: legacy_api_password
    #   api_password: !secret http_password
  customize:
    sensor.humidity:
      icon: mdi:water-percent
  name: Home
  latitude: !secret latitude
  longitude: !secret longitude
  elevation: 45
  unit_system: metric
  time_zone: Europe/London
  currency: GBP

default_config:

http:
  cors_allowed_origins:
    - https://hass.microserver.space
  server_host: 0.0.0.0
  ip_ban_enabled: true
  login_attempts_threshold: 5
  use_x_forwarded_for: true
  trusted_proxies:
    - "0.0.0.0/0"
    - 127.0.0.1
    - ::1

recorder:
  purge_keep_days: 5
  db_url: !secret db_url
  exclude:
    domains:
      - device_tracker

influxdb:
  host: influxdb.monitoring.svc.cluster.local
  port: 8086
  database: home_assistant
  username: admin
  password: !secret influxdb_password

system_health:

logger:
  default: info
  logs:
    requests.packages.urllib3.connectionpool: critical
    homeassistant.components.alexa: info

frontend:

config:

history:

logbook:

sun:

weather:
  - platform: darksky
    api_key: !secret darksky_apikey
    mode: daily

group: !include groups.yaml
automation: !include automations.yaml
sensor: !include sensors.yaml

mqtt:
  broker: emqx-headless.default.svc
  port: 1883
  client_id: home-assistant
  username: mqtt
  password: !secret mqtt_password
  discovery: true
  discovery_prefix: homeassistant
  birth_message:
    topic: 'homeassistant/status'
    payload: 'online'
  will_message:
    topic: 'homeassistant/status'
    payload: 'offline'

notify:
  - platform: pushbullet
    api_key: !secret pushbullet_apikey
    
light:
  - platform: mqtt
    schema: json
    name: 'Hallway'
    state_topic: 'AiLight-188593'
    command_topic: 'AiLight-188593/set'
    color_temp: true
    brightness: true
    rgb: true
    white_value: true
    effect: false
    optimistic: false

alexa:
  smart_home:
    locale: en-GB
    endpoint: https://api.eu.amazonalexa.com/v3/events
    client_id: !secret alexa_client_id
    client_secret: !secret alexa_client_secret
    filter:
      include_domains:
        - light
        - climate
      include_entities:
        - sensor.landing_temperature
        - sensor.upstairs_temperature
        - sensor.temperature_humidity_sensor_temperature
        - sensor.bme680_temperature

energy:

utility_meter:
  daily_energy:
    source: sensor.electric_consumption_today
    name: Daily Energy
    cycle: daily
    tariffs:
      - peak
      - offpeak
  monthly_energy:
    source: sensor.electric_consumption_today
    name: Monthly Energy
    cycle: monthly
    tariffs:
      - peak
      - offpeak

prometheus:
  namespace: hass

media_player:
  - platform: androidtv
    name: Living Room - Nvidia Shield
    host: 10.30.0.234
    apps:
        com.android.tv.settings: "Settings"
        com.plexapp.android: "Plex"
        com.amazon.avod: "Amazon Prime"
    state_detection_rules:
        'com.android.tv.settings':
          - 'idle'
        'com.android.vending':
          - 'idle'
        'com.plexapp.android':
          - 'paused':
              'media_session_state': 3  # this indentation is important!
              'wake_lock_size': 1       # this indentation is important!
          - 'playing':
              'media_session_state': 3  # this indentation is important!
          - 'standby'
        'com.amazon.avod':
          - 'playing':
              'wake_lock_size': 4  # this indentation is important!
          - 'playing':
              'wake_lock_size': 3  # this indentation is important!
          - 'paused':
              'wake_lock_size': 2  # this indentation is important!
          - 'paused':
              'wake_lock_size': 1  # this indentation is important!
          - 'idle'

alarm_control_panel:
  - platform: manual
    name: Alarm Panel
    code: !secret alarm_code
    arming_time: 20
    delay_time: 30
    trigger_time: 4
    disarmed:
      trigger_time: 0
    armed_home:
      arming_time: 0
      delay_time: 0

input_boolean:
  # auto-run stuff
  auto_arm_disarm_alarm_night:
    name: Arm alarm at midnight and disarm at 5am
  auto_arm_alarm_when_gone:
    name: Automatically arm alarm when no one is home
    initial: on
  auto_disarm_alarm_when_home:
    name: Automatically disarm alarm when someone comes home
    initial: on
  
  # notifications
  notify_alarm_armed:
    name: Notification when alarm is armed
    initial: on
  notify_alarm_disarmed:
    name: Notification when alarm is disarmed
    initial: on
  notify_alarm_triggered:
    name: Notification when alarm is triggered
    initial: on
  
  # Heating
  enable_heating_schedules:
    name: Enable heating schedules
    initial: on
  heating_mode:
    name: Heating mode
    initial: on
  
  #people
  russell_occupancy:
    name: Russell is home (bluetooth)